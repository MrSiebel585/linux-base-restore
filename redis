
#!/bin/bash

echo "ğŸ”§ Starting Redis repair..."

echo "ğŸ§¼ Fixing permissions..."
chown -R redis:redis /var/lib/redis
chmod 770 /var/lib/redis

if [ -f /run/redis/redis-server.pid ]; then
    echo "ğŸ§¹ Removing stale PID file..."
    rm /run/redis/redis-server.pid
fi

echo "ğŸ” Checking Redis config..."
REDIS_CONF=$(find /etc -name redis.conf | head -1)
if [[ ! -f "$REDIS_CONF" ]]; then
    echo "âŒ Config not found! Reinstalling..."
    apt-get install --reinstall redis-server -y
else
    echo "âœ”ï¸ Config found at: $REDIS_CONF"
fi

echo "ğŸš€ Restarting Redis..."
systemctl daemon-reexec
systemctl restart redis-server
systemctl enable redis-server

echo "ğŸ“œ Redis status:"
systemctl status redis-server --no-pager

echo "âœ… Redis repair complete."
